<!DOCTYPE html>
<html lang="fa" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>تقی پور نشر</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <style>
    /* استایل‌ها مثل قبل */
    /* ... (همون کدی که بهت دادم بالا) ... */
  </style>
</head>
<body>
<div class="container">
  <header>
    <div class="logo-container">
      <img src="logo.png" alt="تقی پور نشر" class="logo">
      <h1>تقی پور نشر</h1>
    </div>
    <div id="user-info"></div>
  </header>

  <nav>
    <ul>
      <li><a href="#" class="nav-link active" data-page="home">خانه</a></li>
      <li><a href="#" class="nav-link" data-page="rules">قوانین و مقررات</a></li>
      <li><a href="#" class="nav-link" data-page="settings">تنظیمات</a></li>
    </ul>
  </nav>

  <div class="main-content">
    <aside class="sidebar">
      <div class="action-buttons">
        <button id="login-btn" class="btn-login"><i class="fas fa-sign-in-alt"></i> ورود با گوگل</button>
        <button id="logout-btn" class="btn-logout" style="display:none;"><i class="fas fa-sign-out-alt"></i> خروج</button>
      </div>
      <div id="user-profile" style="display:none;">
        <div class="user-card">
          <img src="https://ui-avatars.com/api/?name=User&background=4a6fa5&color=fff" id="user-avatar" class="user-avatar">
          <h3 id="profile-name">نام کاربری</h3>
          <p id="profile-email">email@example.com</p>
        </div>
      </div>
    </aside>

    <main class="content">
      <div id="home-page" class="page active">
        <div id="tweet-box" style="display:none;">
          <div class="tweet-box">
            <h3><i class="fas fa-pen"></i> نوشتن توییت جدید</h3>
            <textarea id="tweet-input" placeholder="چیزی که فکر می‌کنید را اینجا بنویسید..."></textarea>
            <button id="post-btn" class="btn-primary"><i class="fas fa-paper-plane"></i> ارسال توییت</button>
          </div>
        </div>
        <h3><i class="fas fa-stream"></i> آخرین توییت‌ها</h3>
        <div id="tweets"></div>
      </div>

      <div id="rules-page" class="page">
        <div class="tweet-box">
          <h2><i class="fas fa-gavel"></i> قوانین و مقررات</h2>
          <p>با استفاده از پلتفرم تقی پور نشر، شما موافقت می‌کنید که به قوانین و مقررات زیر پایبند باشید:</p>
          <ul><li>...</li></ul>
          <p class="copyright">آخرین به‌روزرسانی: <span id="last-update"></span></p>
        </div>
      </div>

      <div id="settings-page" class="page">
        <div class="settings-panel">
          <h2><i class="fas fa-cog"></i> تنظیمات</h2>
          <div class="settings-group">
            <h3>تنظیمات نمایش</h3>
            <div class="setting-item">
              <span>حالت شب</span>
              <input type="checkbox" id="dark-mode">
            </div>
            <div class="setting-item">
              <span>فونت درشت</span>
              <input type="checkbox" id="large-font">
            </div>
          </div>
          <button id="save-settings" class="btn-primary"><i class="fas fa-save"></i> ذخیره تنظیمات</button>
        </div>
      </div>
    </main>
  </div>

  <footer>
    <div class="footer-content">
      <div class="footer-section">
        <h3>درباره ما</h3>
        <p>تقی پور نشر یک پلتفرم اجتماعی برای به اشتراک گذاری افکار و ایده‌ها است.</p>
      </div>
      <div class="footer-section">
        <h3>شبکه های اجتماعی</h3>
        <div class="social-icons">
          <a href="https://www.instagram.com/parhammmm322/" target="_blank"><i class="fab fa-instagram"></i></a>
          <a href="https://t.me/mmdparham91" target="_blank"><i class="fas fa-paper-plane"></i></a>
        </div>
      </div>
    </div>
    <div class="copyright">
      <p>© <span id="year"></span> تقی پور نشر - تمام حقوق محفوظ است</p>
    </div>
  </footer>
</div>

<div id="toast" class="toast">تنظیمات با موفقیت ذخیره شد</div>

<script>
  // --- Firebase Config ---
  const firebaseConfig = {
    apiKey: "AIzaSyDbIq00yvB2xJTtqmoUo-xFj10hYEYl9Ac",
    authDomain: "parsnashr-eb1f3.firebaseapp.com",
    projectId: "parsnashr-eb1f3",
    storageBucket: "parsnashr-eb1f3.firebasestorage.app",
    messagingSenderId: "875762126889",
    appId: "1:875762126889:web:1f32d90eca2c221ca84c38",
    measurementId: "G-33SLCFGP3N"
  };

  firebase.initializeApp(firebaseConfig);
  const auth = firebase.auth();
  const db = firebase.firestore();

  // --- Auth ---
  const loginBtn = document.getElementById("login-btn");
  const logoutBtn = document.getElementById("logout-btn");
  const userProfile = document.getElementById("user-profile");
  const tweetBox = document.getElementById("tweet-box");

  loginBtn.addEventListener("click", () => {
    const provider = new firebase.auth.GoogleAuthProvider();
    auth.signInWithPopup(provider);
  });

  logoutBtn.addEventListener("click", () => auth.signOut());

  auth.onAuthStateChanged(user => {
    if (user) {
      loginBtn.style.display = "none";
      logoutBtn.style.display = "block";
      userProfile.style.display = "block";
      tweetBox.style.display = "block";
      document.getElementById("profile-name").textContent = user.displayName;
      document.getElementById("profile-email").textContent = user.email;
      document.getElementById("user-avatar").src = user.photoURL;
      loadSettings(user.uid);
      loadTweets();
    } else {
      loginBtn.style.display = "block";
      logoutBtn.style.display = "none";
      userProfile.style.display = "none";
      tweetBox.style.display = "none";
      document.getElementById("tweets").innerHTML = "";
    }
  });

  // --- Tweets ---
  document.getElementById("post-btn").addEventListener("click", async () => {
    const content = document.getElementById("tweet-input").value;
    if (content.trim() === "") return;
    const user = auth.currentUser;
    await db.collection("tweets").add({
      uid: user.uid,
      name: user.displayName,
      avatar: user.photoURL,
      content,
      likes: [],
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });
    document.getElementById("tweet-input").value = "";
  });

  function loadTweets() {
    db.collection("tweets").orderBy("createdAt", "desc").onSnapshot(snapshot => {
      const tweetsDiv = document.getElementById("tweets");
      tweetsDiv.innerHTML = "";
      snapshot.forEach(doc => {
        const t = doc.data();
        const user = auth.currentUser;
        const liked = t.likes.includes(user?.uid);
        const time = t.createdAt?.toDate().toLocaleString("fa-IR") || "";
        const div = document.createElement("div");
        div.className = "tweet";
        div.innerHTML = `
          <div class="tweet-header">
            <img src="${t.avatar}" class="tweet-avatar">
            <div class="tweet-user">${t.name}</div>
            <div class="tweet-time">${time}</div>
          </div>
          <div class="tweet-content">${t.content}</div>
          <div class="tweet-actions">
            <div class="tweet-action ${liked ? "liked":""}" onclick="toggleLike('${doc.id}')">
              <i class="fas fa-heart"></i> ${t.likes.length}
            </div>
          </div>
        `;
        tweetsDiv.appendChild(div);
      });
    });
  }

  async function toggleLike(id) {
    const user = auth.currentUser;
    const ref = db.collection("tweets").doc(id);
    const docSnap = await ref.get();
    if (!docSnap.exists) return;
    const likes = docSnap.data().likes || [];
    if (likes.includes(user.uid)) {
      await ref.update({ likes: firebase.firestore.FieldValue.arrayRemove(user.uid) });
    } else {
      await ref.update({ likes: firebase.firestore.FieldValue.arrayUnion(user.uid) });
    }
  }

  // --- Settings ---
  const darkModeCheckbox = document.getElementById("dark-mode");
  const largeFontCheckbox = document.getElementById("large-font");

  document.getElementById("save-settings").addEventListener("click", async () => {
    const user = auth.currentUser;
    if (!user) return;
    const settings = {
      darkMode: darkModeCheckbox.checked,
      largeFont: largeFontCheckbox.checked
    };
    await db.collection("settings").doc(user.uid).set(settings);
    applySettings(settings);
    showToast("تنظیمات با موفقیت ذخیره شد");
  });

  function loadSettings(uid) {
    db.collection("settings").doc(uid).get().then(doc => {
      if (doc.exists) {
        const s = doc.data();
        darkModeCheckbox.checked = s.darkMode;
        largeFontCheckbox.checked = s.largeFont;
        applySettings(s);
      }
    });
  }

  function applySettings(settings) {
    if (settings.darkMode) {
      document.body.classList.add("theme-dark");
    } else {
      document.body.classList.remove("theme-dark");
    }
    if (settings.largeFont) {
      document.body.classList.add("large-font");
    } else {
      document.body.classList.remove("large-font");
    }
  }

  function showToast(msg) {
    const toast = document.getElementById("toast");
    toast.textContent = msg;
    toast.style.display = "block";
    setTimeout(() => toast.style.display = "none", 3000);
  }

  // --- تغییر سال و تاریخ ---
  document.getElementById("year").textContent = new Date().getFullYear();
  const faDate = new Date().toLocaleDateString('fa-IR');
  document.getElementById("last-update").textContent = faDate;
</script>
</body>
</html>
